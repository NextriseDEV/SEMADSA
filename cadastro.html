<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - SEMADSA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="https://nextrisedev.github.io/SEMADSA/ICONES.png">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; background: #f0f4f8; }
        .hero-pattern { background-color: #1e3a8a; }
        .glass-panel { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 hero-pattern">

    <div class="w-full max-w-md glass-panel rounded-2xl shadow-2xl overflow-hidden relative">
        <a href="https://nextrisedev.github.io/SEMADSA/" class="absolute top-4 left-4 text-white hover:text-blue-200 z-20 text-sm font-bold flex items-center gap-1">
            <i class="fa-solid fa-arrow-left"></i> Início
        </a>

        <div class="bg-blue-900 p-8 text-center relative overflow-hidden">
            <img src="https://nextrisedev.github.io/SEMADSA/SEMADSA-LOGO-PNG.png" alt="SEMADSA" class="h-16 mx-auto mb-2 drop-shadow-lg">
            <h2 class="text-white text-xl font-bold">Cadastro de Contribuinte</h2>
        </div>

        <form id="formCadastro" onsubmit="handleRegister(event)" class="p-8 space-y-4">
            
            <div>
                <label class="block text-xs font-bold text-blue-800 uppercase mb-1">Nome Completo</label>
                <input type="text" id="nome" required class="w-full p-2 border rounded-lg focus:border-blue-500 outline-none uppercase" placeholder="SEU NOME">
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs font-bold text-blue-800 uppercase mb-1">CPF</label>
                    <input type="text" id="cpf" required class="w-full p-2 border rounded-lg focus:border-blue-500 outline-none" placeholder="000.000.000-00" oninput="maskCPF(this)">
                </div>
                <div>
                    <label class="block text-xs font-bold text-blue-800 uppercase mb-1">Nascimento</label>
                    <input type="date" id="nascimento" required class="w-full p-2 border rounded-lg focus:border-blue-500 outline-none">
                </div>
            </div>

            <div>
                <label class="block text-xs font-bold text-blue-800 uppercase mb-1">E-mail</label>
                <input type="email" id="email" required class="w-full p-2 border rounded-lg focus:border-blue-500 outline-none" placeholder="seu@email.com">
            </div>

            <div>
                <label class="block text-xs font-bold text-blue-800 uppercase mb-1">WhatsApp</label>
                <input type="tel" id="whatsapp" required class="w-full p-2 border rounded-lg focus:border-blue-500 outline-none" placeholder="(11) 99999-9999" oninput="maskPhone(this)">
            </div>

            <div>
                <label class="block text-xs font-bold text-blue-800 uppercase mb-1">Senha</label>
                <input type="password" id="senha" required class="w-full p-2 border rounded-lg focus:border-blue-500 outline-none" placeholder="******">
            </div>

            <div class="flex items-start gap-3 pt-2">
                <input type="checkbox" id="lgpd" required class="mt-1 w-4 h-4 text-blue-600 rounded">
                <label for="lgpd" class="text-xs text-gray-500 leading-relaxed">
                    Concordo com os termos e com o recebimento de mensagens missionárias.
                </label>
            </div>

            <button type="submit" id="btnSubmit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl shadow-lg transition">
                FINALIZAR CADASTRO
            </button>

            <p class="text-center text-xs text-gray-400 mt-4">
                Já tem conta? <a href="login.html" class="text-blue-600 font-bold hover:underline">Fazer Login</a>
            </p>
        </form>
    </div>

<script>
    // ⚠️ ATENÇÃO: URL DO APP SCRIPT
    const API_URL = 'https://script.google.com/macros/s/AKfycbx4eQLrogacDoirc1yrM20rWc0Hi4AbeLXrcKHZedgXmDPr_tH3uBaBzryzD_uTR-wDqQ/exec';

    async function handleRegister(e) {
        e.preventDefault();
        const btn = document.getElementById('btnSubmit');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> ...';
        btn.disabled = true;

        const payload = {
            action: 'register',
            nome: document.getElementById('nome').value,
            cpf: document.getElementById('cpf').value,
            email: document.getElementById('email').value,
            whatsapp: document.getElementById('whatsapp').value,
            nascimento: document.getElementById('nascimento').value,
            senha: document.getElementById('senha').value,
            termos: document.getElementById('lgpd').checked
        };

        try {
            const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify(payload) });
            const data = await res.json();

            if(data.status === 'success') {
                alert("Cadastro realizado! Bem-vindo.");
                window.location.href = 'login.html';
            } else {
                alert("Erro: " + data.message);
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        } catch (err) {
            console.error(err);
            alert("Erro de conexão.");
            btn.innerHTML = originalText;
            btn.disabled = false;
        }
    }

    const maskCPF = (el) => el.value = el.value.replace(/\D/g,'').replace(/(\d{3})(\d)/,'$1.$2').replace(/(\d{3})(\d)/,'$1.$2').replace(/(\d{3})(\d{1,2})/, '$1-$2').replace(/(-\d{2})\d+?$/, '$1');
    const maskPhone = (el) => {
        let r = el.value.replace(/\D/g, "").replace(/^0/, "");
        if (r.length > 10) r = r.replace(/^(\d\d)(\d{5})(\d{4}).*/, "($1) $2-$3");
        else if (r.length > 5) r = r.replace(/^(\d\d)(\d{4})(\d{0,4}).*/, "($1) $2-$3");
        else r = r.replace(/^(\d*)/, "($1"); el.value = r;
    }
</script>
</body>
</html>
